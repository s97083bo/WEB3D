<!DOCTYPE html>
<html>
<head>
  <title>UwU</title>
<link rel="icon"  href="03.jpg">
<style>
#info {
  position: absolute;
  top: 0px;
  width: 100%;
  padding: 10px;
  text-align: center;
  color: #ffff00
}

body {
  overflow: hidden;
}

</style>
</head>
<body>
<div id="info">CLOCK
 <br><button id="btn0">reciprocal</button>
 <button id="btn1">analog</button>
<button id="btn2">+10sec</button>
<button id="btn3">reset</button>
<script src="https://threejs.org/build/three.min.js"></script>
<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>

</div>

<audio id="soundtrack" style="display:none">
<source src="sound.mp3"  type='audio/mp3'>
</audio>




<script>
var camera, scene, renderer ,soundTrack;
var angle=0;
var turn = false;
init();
animate();

function buildPlane() {
  var geometry = new THREE.BufferGeometry();
  var indices = [];
  var points = [];
  var colors = [];
  
  angle=0;
  {
  for(let i=0;i<20;i++){
  points.push(60*Math.cos(angle-Math.PI/6), 20, 60*Math.sin(angle));
  angle+=Math.PI/10;   //上面的小20邊橢圓 1
  }
  for(let i=0;i<20;i++){
  points.push(80*Math.cos(angle-Math.PI/6), 20, 80*Math.sin(angle));
  angle+=Math.PI/10;   //上面的大20邊橢圓 1
  }
  for(let i=0;i<20;i++){
  points.push(60*Math.cos(angle-Math.PI/6), 10, 60*Math.sin(angle));
  angle+=Math.PI/10;   //下面的小20邊橢圓 1
  }
  for(let i=0;i<20;i++){
  points.push(80*Math.cos(angle-Math.PI/6), 10, 80*Math.sin(angle));
  angle+=Math.PI/10;   //下面的大20邊橢圓 1   
  }
  }
  
  
  for(let i=0;i<20;i++){
  points.push(48*Math.cos(angle-Math.PI), 21, 48*Math.sin(angle));
  angle+=Math.PI/10;   //時鐘
  }
  for(let i=0;i<20;i++){
  points.push(48*Math.cos(angle-Math.PI), 9, 48*Math.sin(angle));
  angle+=Math.PI/10;   //時鐘
  }
  {
  for(let i=0;i<20;i++){
  points.push(65*Math.cos(angle), 19, 65*Math.sin(angle-Math.PI/5));
  angle+=Math.PI/10;   //上面的小20邊橢圓 2
  }
  for(let i=0;i<20;i++){
  points.push(85*Math.cos(angle), 19, 85*Math.sin(angle-Math.PI/5));
  angle+=Math.PI/10;   //上面的大20邊橢圓  2  
  }
  for(let i=0;i<20;i++){
  points.push(65*Math.cos(angle), 11, 65*Math.sin(angle-Math.PI/5));
  angle+=Math.PI/10;   //下面的小20邊橢圓 2
  }
  for(let i=0;i<20;i++){
  points.push(85*Math.cos(angle), 11, 85*Math.sin(angle-Math.PI/5));
  angle+=Math.PI/10;   //下面的大20邊橢圓    
  }
  }
  
  
  
  points.push(2,22,-48, -2,22,-48, 0,22,-45); //原點的checker
  
  
  
  {
  for(let i=0;i<20;i++){
  indices.push(i,(i+1)%20,(i+20));
  indices.push((i+1)%20,(i+20),(i+21)%40+Math.floor((i+1)/20)*20);//上橢圓面
  }
  
	for(let i=40;i<60;i++){
  indices.push(i,(i+1)%60+Math.floor((i+1)/60)*40,(i+20));
  indices.push((i+1)%60+Math.floor((i+1)/60)*40,(i+20),(i+21)%80+Math.floor((i+1)/60)*60);//下橢圓面
  }

  for(let i=0;i<20;i++){
  indices.push(i,(i+1)%20,(i+40));
  indices.push((i+1)%20,(i+40),(i+41)%60+Math.floor((i+41)/60)*40);
  }//內邊
  for(let i=20;i<40;i++){
  indices.push(i,(i+1)%40+Math.floor((i+1)/40)*20,(i+40));
  indices.push((i+1)%40+Math.floor((i+1)/40)*20,(i+40),(i+41)%80+Math.floor((i+1)/40)*60);//外邊
  }
  
  }//橢圓1
  
  for(let i=80;i<99;i++){
  indices.push(80,(i+1),i);//下時鐘
  }
  for(let i=100;i<119;i++){
  indices.push(100,(i+1),i);//上時鐘
  }
  for(let i=80;i<100;i++){  
  indices.push(i,(i+1)%100+Math.floor((i+1)/100)*80,(i+20));
  indices.push((i+1)%100+Math.floor((i+1)/100)*80,(i+20),(i+21)%120+Math.floor((i+1)/100)*100);//時鐘外邊 
  }

  for(let i=120;i<140;i++){//橢圓2
  if(i===122)i+=3;
  if(i===132)i+=3;
  indices.push(i,(i+1)%140+Math.floor((i+1)/140)*120,(i+20));
  indices.push((i+1)%140+Math.floor((i+1)/140)*120,(i+20),(i+21)%160+Math.floor((i+21)/160)*140);//上橢圓面2
  
  }
  
	for(let i=160;i<180;i++){
  if(i===172)i+=3;
  if(i===162)i+=3;
  indices.push(i,(i+1)%180+Math.floor((i+1)/180)*160,(i+20));
  indices.push((i+1)%180+Math.floor((i+1)/180)*160,(i+20),(i+21)%200+Math.floor((i+21)/200)*180);//下橢圓面2
  }

  for(let i=120;i<140;i++){
  if(i===132)i+=3;
  if(i===122)i+=3;
  indices.push(i,(i+1)%140+Math.floor((i+1)/140)*120,(i+40));
  indices.push((i+1)%140+Math.floor((i+1)/140)*120,(i+40),(i+41)%180+Math.floor((i+41)/180)*160);
  }//內邊2
  
  for(let i=140;i<160;i++){
  if(i===152)i+=3;
  if(i===142)i+=3;
  indices.push(i,(i+1)%160+Math.floor((i+1)/160)*140,(i+40));
  indices.push((i+1)%160+Math.floor((i+1)/160)*140,(i+40),(i+41)%200+Math.floor((i+41)/200)*180);//外邊2
  }
  
  indices.push(200,201,202);
 
  
  for (let i = 0; i <40; i++) {  //上橢圓1
   colors.push(240/255, 155/255, 13/255);
  }
  for (let i = 0; i <40; i++) {
    colors.push(140/255, 70/255, 17/255);  //下橢圓1
  }
 
  for (let i = 0; i <20; i++) {
    colors.push(171/255, 171/255, 171/255); //上時鐘
  }
  for (let i = 0; i <20; i++) {
    colors.push(0/255, 0/255, 0/255);   //下時鐘
  }
  for (let i = 0; i <40; i++) {
    colors.push(233/255, 45/255, 95/255);   //上橢圓2
  }
  for (let i = 0; i <40; i++) {
    colors.push(120/255, 12/255, 17/255);//下橢圓2
  }
  
	geometry.setIndex (indices);
  geometry.computeBoundingSphere();
  geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3));
  geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
  geometry.computeVertexNormals();
	let material = new THREE.MeshBasicMaterial({  //有試著用過金屬打燈 但效果不理想
    color: 'white',
    vertexColors: true,
    //flatShading: false,
    side: THREE.DoubleSide
  });
  let pointer = new THREE.Mesh(geometry, material);

  
  return pointer;

}
function niddle(){ //指針
var geometry = new THREE.BufferGeometry();
  var indices = [];
  var points = [];
  var colors = [];
  points.push(-3,25,0 ,-3,20,0 ,0,25,-45 ,0,20,-45 ,3,25,0 ,3,20,0 ); 
  
  indices.push(0,1,4, 1,4,5, 1,3,5, 0,2,4, 0,1,2, 1,2,3, 2,3,4, 3,4,5);

	geometry.setIndex (indices);
  geometry.computeBoundingSphere();
  geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3));
  geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
  geometry.computeVertexNormals();
	let material = new THREE.MeshBasicMaterial({
    color: 'white',
    vertexColors: true,
    //flatShading: false,
    side: THREE.DoubleSide
  });

let ptr = new THREE.Mesh(geometry, material);
  return ptr;
}
function init() {
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(30, window.innerWidth / window.innerHeight, 1, 1000);
  camera.position.y = 500;
  soundTrack = document.getElementById ('soundtrack');
	var light;
  light = new THREE.PointLight(0xffffff, 3, 3000);
  light.position.set(0, 100, 0);
  //scene.add(light);
  var sphereSize = 5;
  pointLightHelper = new THREE.PointLightHelper(light, sphereSize);
  //scene.add(pointLightHelper);
  
  //scene.add(gridXZ);

  renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setClearColor(0x888888);

  let controls = new THREE.OrbitControls(camera, renderer.domElement);

  document.body.appendChild(renderer.domElement);
  /////////////////////////////////////////////////////

	var plane = buildPlane();
  var nid = niddle();
  group = new THREE.Group();
  //plane.position.set(-20, -35, 0)
  
	group.add(nid);
	scene.add (plane);
  scene.add (group);
}
var plus =false;  //+10sec
var analog =false;
var analogisbusy=false;
angle=2*Math.PI;
function animate() {
	var btn0 = document.getElementById('btn0');   //reciprocal
  btn0.onclick = function() {
    turn = !turn;
    analog=false;
    soundTrack.pause();
  }
 var btn1 = document.getElementById('btn1');   //analog
  btn1.onclick = function() {
    analog =!analog;
    turn=false;
    soundTrack.pause();
  }
  var btn2 = document.getElementById('btn2');  //+10sec
  btn2.onclick = function() {
  angle+=Math.PI/3;
  angle=angle%(Math.PI*2);    //超過2PI 就%
  group.rotation.y= -angle;  
  soundTrack.pause();
  }
  var btn3 = document.getElementById('btn3');  //reset
  btn3.onclick = function() {
    angle=2*Math.PI;
    group.rotation.y= -angle;
    turn=false;
    analog=false;
    soundTrack.pause();
  }
  if(analog){  
  //1秒1真
  if(analogisbusy===false){   //如果沒有在忙
  analogisbusy=true;     //設這東西防止一直被call
  window.setTimeout(function(){      
  if(analog===true){    //再次確認開關有開著
  angle-=Math.PI/30;  //一秒的角度
  group.rotation.y= -angle;
  }
  analogisbusy=false;}, 1000);}
  //再次開放
  
  if(angle%(Math.PI*2)<0.01&&angle<Math.PI*2){     //判定 接近0的時候
  	analog=false;  //到了就關掉
    angle=2*Math.PI;  
    group.rotation.y= -angle;//停 Reset
    soundTrack.play();
  	}
    
  }
  if (turn){
  if((angle-0.001)%(2*Math.PI)<0.001){     //判定 接近0的時候
  	turn=false;
    angle=2*Math.PI;              //停 Reset
    soundTrack.play();
  	}
  angle-=0.00072;
  group.rotation.y = -angle;	
  }
  requestAnimationFrame(animate);
  renderer.render(scene, camera);

}




</script>


</body>
</html>

